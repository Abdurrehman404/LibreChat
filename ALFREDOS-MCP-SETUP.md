# AlfredOS MCP Setup Guide

This guide explains how MCP (Model Context Protocol) servers are configured in AlfredOS to connect LibreChat with your business tools.

## Overview

AlfredOS uses Smithery MCP servers to connect LibreChat with various services like n8n, Ghost, Cal.com, and Supabase. Each MCP server acts as a bridge between the AI and your business tools.

## How It Works

### 1. Service API Keys (Auto-generated or Manual)
Each service needs its own API key:
- **N8N_API_KEY**: Auto-generated by your n8n setup script
- **GHOST_STAFF_API_KEY**: You need to set this manually
- **CALCOM_API_KEY**: You need to set this manually  
- **SUPABASE_ACCESS_TOKEN**: You need to set this manually

### 2. Smithery Authentication
All MCP servers use a single Smithery API key:
- **SMITHERY_API_KEY**: Your Smithery account API key (used for all MCP servers)

### 3. LibreChat Configuration
The `librechat.yaml` file uses environment variables to configure each MCP server:

```yaml
mcpServers:
  n8n:
    type: streamable-http
    url: "https://server.smithery.ai/@guinness77/n8n-mcp-server/mcp"
    params:
      # Smithery authentication (same for all)
      api_key: "${SMITHERY_API_KEY}"
      profile: "n8n"
      # n8n specific configuration
      apiUrl: "${N8N_URL}"
      apiKey: "${N8N_API_KEY}"
```

## Environment Variables Summary

### Required for All MCP Servers
- `SMITHERY_API_KEY` - Your Smithery API key (get it from smithery.ai)

### Service-Specific Variables

#### n8n (Auto-generated)
- `N8N_URL` - The URL of your n8n instance (auto-set by Railway)
- `N8N_API_KEY` - n8n API key (auto-generated by setup script)

#### Ghost CMS
- `GHOST_API_URL` - Your Ghost site URL (e.g., https://your-ghost-site.com)
- `GHOST_STAFF_API_KEY` - Ghost Staff/Admin API key

#### Cal.com
- `CALCOM_API_KEY` - Your Cal.com API key

#### Supabase
- `SUPABASE_ACCESS_TOKEN` - Your Supabase access token

## Setup Process

### Step 1: Set Your Smithery API Key
1. Get your API key from [smithery.ai](https://smithery.ai)
2. Set it as a Railway environment variable: `SMITHERY_API_KEY=your-key-here`

### Step 2: Configure Service-Specific Variables
Set these in your Railway environment:
- For Ghost: `GHOST_API_URL` and `GHOST_STAFF_API_KEY`
- For Cal.com: `CALCOM_API_KEY`
- For Supabase: `SUPABASE_ACCESS_TOKEN`

### Step 3: Deploy LibreChat
LibreChat will automatically pick up all the environment variables and configure the MCP servers.

## Railway Function (Optional)

The `railway-mcp-sync-final.ts` function can be used to ensure your Smithery API key is properly set across all Railway services. This is optional if you're manually setting environment variables.

## Troubleshooting

### MCP Server Not Working?
1. Check that `SMITHERY_API_KEY` is set
2. Verify service-specific variables are set (e.g., `N8N_API_KEY`)
3. Ensure your LibreChat YAML is properly formatted
4. Check LibreChat logs for connection errors

### Common Issues
- **"api_key is required"**: Your `SMITHERY_API_KEY` is not set
- **"Failed to connect to service"**: Service-specific variables are missing
- **MCP tools not showing up**: LibreChat may need to be restarted after configuration changes 